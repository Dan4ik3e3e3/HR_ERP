#!/bin/bash

# Проверяем наличие аргумента с путем к резервной копии
if [ -z "$1" ]; then
    echo "Использование: $0 <путь_к_резервной_копии>"
    exit 1
fi

BACKUP_PATH=$1

# Проверяем существование файла резервной копии
if [ ! -f "$BACKUP_PATH" ]; then
    echo "Ошибка: Файл резервной копии не найден: $BACKUP_PATH"
    exit 1
fi

# Останавливаем сервисы
echo "Останавливаем сервисы..."
docker-compose down

# Восстанавливаем данные
echo "Восстанавливаем данные..."
tar -xzf "$BACKUP_PATH" -C .

# Проверяем целостность данных
echo "Проверяем целостность данных..."
docker-compose run --rm app1 node -e "require('./src/utils/logger').Logger.info('Проверка целостности данных после восстановления')"

# Запускаем сервисы
echo "Запускаем сервисы..."
docker-compose up -d

# Проверяем статус сервисов
echo "Проверяем статус сервисов..."
docker-compose ps

echo "Восстановление завершено!" 